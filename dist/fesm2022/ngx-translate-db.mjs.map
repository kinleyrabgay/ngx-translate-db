{"version":3,"file":"ngx-translate-db.mjs","sources":["../../src/lib/service/translate-db.service.ts","../../src/lib/service/translate.service.ts","../../src/lib/pipe/translate.pipe.ts","../../src/lib/translate.module.ts","../../src/public-api.ts","../../src/ngx-translate-db.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { openDB, IDBPDatabase, deleteDB } from 'idb';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TranslationDBService {\n  private db!: IDBPDatabase;\n\n  async init(): Promise<void> {\n    try {\n      this.db = await openDB('translations-db', 1, {\n        upgrade(db) {\n          if (!db.objectStoreNames.contains('translations')) {\n            db.createObjectStore('translations');\n          }\n        },\n      });\n    } catch (error) {\n      console.error('Error initializing translation database:', error);\n      throw error;\n    }\n  }\n\n  async saveToCache(key: string, value: { [lang: string]: string }): Promise<void> {\n    await this.db.put('translations', value, key);\n  }\n\n  async getFromCache(key: string): Promise<{ [lang: string]: string } | null> {\n    return await this.db.get('translations', key);\n  }\n\n  async clearCache(): Promise<void> {\n    await this.db.clear('translations');\n  }\n\n  async clearDB(): Promise<void> {\n    await this.db.close();\n    await deleteDB('translations-db');\n  }\n}\n","import { Injectable, Inject, Optional } from '@angular/core';\nimport { TranslationConfig, TranslationValue } from '../interface/translation.interface';\nimport { TranslationDBService } from './translate-db.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TranslateService {\n  private currentLang: string = 'en';\n  private translations: { [key: string]: TranslationValue } = {};\n  private initialized = false;\n  private config!: TranslationConfig;\n\n  constructor(\n    private dbService: TranslationDBService,\n    @Optional() @Inject('TRANSLATE_CONFIG') config: TranslationConfig\n  ) {\n    if (config) {\n      this.init(config).catch(err => console.error('Failed to initialize translation service:', err));\n    }\n  }\n\n  async init(config: TranslationConfig): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    this.config = config;\n    this.currentLang = config.defaultLang;\n\n    try {\n      await this.dbService.init();\n      await this.loadTranslations();\n      this.initialized = true;\n    } catch (error) {\n      console.error('Error initializing translation service:', error);\n    }\n  }\n\n  private async loadTranslations(): Promise<void> {\n    try {\n      const translations = await this.fetchTranslations();\n      for (const [key, value] of Object.entries(translations)) {\n        await this.dbService.saveToCache(key, value);\n        this.translations[key] = value;\n      }\n    } catch (error) {\n      console.error('Error loading translations:', error);\n    }\n  }\n\n  private async fetchTranslations(): Promise<{ [key: string]: TranslationValue }> {\n    try {\n      // Mock API call to fetch translations (replace with actual API in production)\n      return {\n        \"BTN_LOGIN\": { \"en\": \"Logging from here\", \"fr\": \"Connexion\", \"it\": \"Accesso\" },\n        \"BTN_REGISTER\": { \"en\": \"Register\", \"fr\": \"S'inscrire\", \"it\": \"Registrati\" },\n        \"BTN_LOGOUT\": { \"en\": \"Logout\", \"fr\": \"DÃ©connexion\", \"it\": \"Disconnettersi\" },\n        \"BTN_PROFILE\": { \"en\": \"Profile\", \"fr\": \"Profil\", \"it\": \"Profilo\" }\n      };\n    } catch (error) {\n      console.error('Error fetching translations:', error);\n      return {};\n    }\n  }\n\n  instant(key: string): string {\n    const translation = this.translations[key];\n    return translation ? (translation[this.currentLang] || key) : key;\n  }\n\n  async setLanguage(lang: string): Promise<void> {\n    this.currentLang = lang;\n  }\n\n  async clearModuleCache(): Promise<void> {\n    await this.dbService.clearCache();\n    this.translations = {};\n  }\n\n  async clearAllCache(): Promise<void> {\n    await this.dbService.clearDB();\n    this.translations = {};\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { TranslateService } from '../service/translate.service';\n\n@Pipe({\n  name: 'appTranslate',\n  standalone: true\n})\nexport class TranslatePipe implements PipeTransform {\n  constructor(private translateService: TranslateService) {}\n\n  transform(key: string): string {\n    return this.translateService.instant(key);\n  }\n} ","import { NgModule } from '@angular/core';\nimport { TranslatePipe } from './pipe/translate.pipe';\nimport { TranslateService } from './service/translate.service';\nimport { TranslationConfig } from './interface/translation.interface';\n\n@NgModule({\n  imports: [TranslatePipe],\n  exports: [TranslatePipe],\n  providers: [TranslateService]\n})\nexport class TranslateDBModule {\n  static forRoot(config: TranslationConfig) {\n    return {\n      ngModule: TranslateDBModule,\n      providers: [\n        {\n          provide: 'TRANSLATE_CONFIG',\n          useValue: config\n        }\n      ]\n    };\n  }\n} ","/*\n * Public API Surface of ngx-translate-db\n */\nexport { TranslateService } from './lib/service/translate.service';\nexport { TranslatePipe } from './lib/pipe/translate.pipe';\nexport { TranslateDBModule } from './lib/translate.module';\nexport { TranslationConfig } from './lib/interface/translation.interface'; ","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i1.TranslateService"],"mappings":"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"}